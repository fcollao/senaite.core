<?xml version="1.0"?>
<dc-workflow xmlns:i18n="http://xml.zope.org/namespaces/i18n"
             workflow_id="bika_ar_workflow"
             title="Sample Workflow"
             description=""
             state_variable="review_state"
             initial_state="sample_registered"
             manager_bypass="False"
             i18n:domain="senaite.core">

  <!-- *** MANAGED PERMISSIONS  *** -->

  <permission>BIKA: Add Analysis</permission>
  <permission>BIKA: Add Attachment</permission>
  <permission>BIKA: Cancel and reinstate</permission>
  <permission>BIKA: Edit AR</permission>
  <permission>BIKA: Edit Field Results</permission>
  <permission>BIKA: Edit Results</permission>
  <permission>BIKA: Manage Invoices</permission>
  <permission>BIKA: Preserve Sample</permission>
  <permission>BIKA: Publish</permission>
  <permission>BIKA: Receive Sample</permission>
  <permission>BIKA: Sample Sample</permission>
  <permission>BIKA: Schedule Sampling</permission>
  <permission>BIKA: Verify</permission>
  <permission>BIKA: View Results</permission>
  <!-- Client can only reject an AR when is not yet received.
       Labman can only reject an AR when is not yet verified. -->
  <permission>Modify portal content</permission>
  <permission>Reject Analysis Request</permission>
  <permission>View</permission>

  <!-- Field-specific permissions
  Are meant to be used for "read_permission" and "write_permission" in fields.
  If not defined there, "read_permission" defaults to "View" and
  "write_permission" defaults to "Modify portal content" -->
  <permission>Field: Edit Batch</permission>
  <permission>Field: Edit Client Order Number</permission>
  <permission>Field: Edit Client Reference</permission>
  <permission>Field: Edit Client Sample ID</permission>
  <permission>Field: Edit Client</permission>
  <permission>Field: Edit Composite</permission>
  <permission>Field: Edit Contact</permission>
  <permission>Field: Edit Container</permission>
  <permission>Field: Edit Date Preserved</permission>
  <permission>Field: Edit Date Received</permission>
  <permission>Field: Edit Date Sampled</permission>
  <permission>Field: Edit Environmental Conditions</permission>
  <permission>Field: Edit Invoice Exclude</permission>
  <permission>Field: Edit Member Discount</permission>
  <permission>Field: Edit Preservation</permission>
  <permission>Field: Edit Preserver</permission>
  <permission>Field: Edit Priority</permission>
  <permission>Field: Edit Profiles</permission>
  <permission>Field: Edit Publication Specification</permission>
  <permission>Field: Edit Rejection Reasons</permission>
  <permission>Field: Edit Results Interpretation</permission>
  <permission>Field: Edit Sample Condition</permission>
  <permission>Field: Edit Sample Point</permission>
  <permission>Field: Edit Sample Type</permission>
  <permission>Field: Edit Sampler</permission>
  <permission>Field: Edit Sampling Date</permission>
  <permission>Field: Edit Sampling Deviation</permission>
  <permission>Field: Edit Sampling Round</permission>
  <permission>Field: Edit Scheduled Sampler</permission>
  <permission>Field: Edit Specification</permission>
  <permission>Field: Edit Storage Location</permission>
  <permission>Field: Edit Template</permission>


  <!-- *** STATES *** -->


  <!-- State: sample_registered (inital state) -->
  <state state_id="sample_registered" title="Registered" i18n:attributes="title" purge="True">
    <description>Creation</description>
    <description>Sample is registered in the system</description>

    <!-- TRANSITIONS -->
    <exit-transition transition_id="to_be_sampled"/>
    <exit-transition transition_id="no_sampling_workflow"/>
    <exit-transition transition_id="reject"/>
    <!-- /TRANSITIONS -->

    <!-- MANAGED PERMISSIONS -->
    <permission-map name="BIKA: Add Analysis" acquired="True"/>
    <permission-map name="BIKA: Add Attachment" acquired="True"/>
    <permission-map name="BIKA: Cancel and reinstate" acquired="True"/>
    <permission-map name="BIKA: Edit AR" acquired="True"/>
    <permission-map name="BIKA: Edit Field Results" acquired="True"/>
    <permission-map name="BIKA: Edit Results" acquired="True"/>
    <permission-map name="BIKA: Manage Invoices" acquired="True"/>
    <permission-map name="BIKA: Preserve Sample" acquired="True"/>
    <permission-map name="BIKA: Publish" acquired="True"/>
    <permission-map name="BIKA: Receive Sample" acquired="True"/>
    <permission-map name="BIKA: Sample Sample" acquired="True"/>
    <permission-map name="BIKA: Schedule Sampling" acquired="True"/>
    <permission-map name="BIKA: Verify" acquired="True"/>
    <permission-map name="BIKA: View Results" acquired="True"/>
    <permission-map name="Modify portal content" acquired="True"/>
    <permission-map name="Reject Analysis Request" acquired="True"/>
    <permission-map name="View" acquired="True"/>
    <!-- Field Permissions
         NOTE: This field-specific permissions for "sample_registered" apply to
         Analysis Request Add form! -->
    <permission-map name="Field: Edit Batch" acquired="True"/>
    <permission-map name="Field: Edit Client Order Number" acquired="True"/>
    <permission-map name="Field: Edit Client Reference" acquired="True"/>
    <permission-map name="Field: Edit Client Sample ID" acquired="True"/>
    <permission-map name="Field: Edit Client" acquired="True"/>
    <permission-map name="Field: Edit Composite" acquired="True"/>
    <permission-map name="Field: Edit Contact" acquired="True"/>
    <permission-map name="Field: Edit Container" acquired="True"/>
    <permission-map name="Field: Edit Date Preserved" acquired="True"/>
    <permission-map name="Field: Edit Date Received" acquired="True"/>
    <permission-map name="Field: Edit Date Sampled" acquired="True"/>
    <permission-map name="Field: Edit Environmental Conditions" acquired="True"/>
    <permission-map name="Field: Edit Invoice Exclude" acquired="True"/>
    <permission-map name="Field: Edit Member Discount" acquired="True"/>
    <permission-map name="Field: Edit Preservation" acquired="True"/>
    <permission-map name="Field: Edit Preserver" acquired="True"/>
    <permission-map name="Field: Edit Priority" acquired="True"/>
    <permission-map name="Field: Edit Profiles" acquired="True"/>
    <permission-map name="Field: Edit Publication Specification" acquired="True"/>
    <permission-map name="Field: Edit Rejection Reasons" acquired="True"/>
    <permission-map name="Field: Edit Results Interpretation" acquired="True"/>
    <permission-map name="Field: Edit Sample Point" acquired="True"/>
    <permission-map name="Field: Edit Sample Type" acquired="True"/>
    <permission-map name="Field: Edit Sample Condition" acquired="True"/>
    <permission-map name="Field: Edit Sampler" acquired="True"/>
    <permission-map name="Field: Edit Sampling Date" acquired="True"/>
    <permission-map name="Field: Edit Sampling Deviation" acquired="True"/>
    <permission-map name="Field: Edit Sampling Round" acquired="True"/>
    <permission-map name="Field: Edit Scheduled Sampler" acquired="True"/>
    <permission-map name="Field: Edit Storage Location" acquired="True"/>
    <permission-map name="Field: Edit Template" acquired="True"/>
    <permission-map name="Field: Edit Specification" acquired="True"/>
    <!-- /MANAGED PERMISSIONS -->
  </state>
  <!-- /State: sample_registered (inital state) -->


  <!-- State: scheduled_sampling -->
  <state state_id="scheduled_sampling" title="Scheduled sampling" i18n:attributes="title">
    <description>Scheduled for sampling</description>

    <!-- TRANSITIONS -->
    <exit-transition transition_id="cancel"/>
    <exit-transition transition_id="sample"/>
    <exit-transition transition_id="reject"/>
    <!-- /TRANSITIONS -->

    <!-- MANAGED PERMISSIONS -->
    <permission-map name="BIKA: Add Analysis" acquired="True"/>
    <permission-map name="BIKA: Add Attachment" acquired="True"/>
    <permission-map name="BIKA: Cancel and reinstate" acquired="True"/>
    <permission-map name="BIKA: Edit AR" acquired="True"/>
    <permission-map name="BIKA: Edit Field Results" acquired="True"/>
    <permission-map name="BIKA: Edit Results" acquired="True"/>
    <permission-map name="BIKA: Manage Invoices" acquired="True"/>
    <permission-map name="BIKA: Preserve Sample" acquired="True"/>
    <permission-map name="BIKA: Publish" acquired="True"/>
    <permission-map name="BIKA: Receive Sample" acquired="True"/>
    <permission-map name="BIKA: Sample Sample" acquired="True"/>
    <permission-map name="BIKA: Schedule Sampling" acquired="True"/>
    <permission-map name="BIKA: Verify" acquired="True"/>
    <permission-map name="BIKA: View Results" acquired="True"/>
    <permission-map name="Modify portal content" acquired="True"/>
    <permission-map name="Reject Analysis Request" acquired="True"/>
    <permission-map name="View" acquired="True"/>
    <!-- Field Permissions -->
    <permission-map name="Field: Edit Batch" acquired="True"/>
    <permission-map name="Field: Edit Client Order Number" acquired="True"/>
    <permission-map name="Field: Edit Client Reference" acquired="True"/>
    <permission-map name="Field: Edit Client Sample ID" acquired="True"/>
    <permission-map name="Field: Edit Client" acquired="True"/>
    <permission-map name="Field: Edit Composite" acquired="True"/>
    <permission-map name="Field: Edit Contact" acquired="True"/>
    <permission-map name="Field: Edit Container" acquired="True"/>
    <permission-map name="Field: Edit Date Preserved" acquired="True"/>
    <permission-map name="Field: Edit Date Received" acquired="True"/>
    <permission-map name="Field: Edit Date Sampled" acquired="True"/>
    <permission-map name="Field: Edit Environmental Conditions" acquired="True"/>
    <permission-map name="Field: Edit Invoice Exclude" acquired="True"/>
    <permission-map name="Field: Edit Member Discount" acquired="True"/>
    <permission-map name="Field: Edit Preservation" acquired="True"/>
    <permission-map name="Field: Edit Preserver" acquired="True"/>
    <permission-map name="Field: Edit Priority" acquired="True"/>
    <!-- Make the field 'Profiles' readonly -->
    <permission-map name="Field: Edit Profiles" acquired="False"/>
    <permission-map name="Field: Edit Publication Specification" acquired="True"/>
    <permission-map name="Field: Edit Rejection Reasons" acquired="True"/>
    <permission-map name="Field: Edit Results Interpretation" acquired="True"/>
    <permission-map name="Field: Edit Sample Point" acquired="True"/>
    <!-- Make the field 'SampleType' readonly -->
    <permission-map name="Field: Edit Sample Type" acquired="False"/>
    <permission-map name="Field: Edit Sample Condition" acquired="True"/>
    <permission-map name="Field: Edit Sampler" acquired="True"/>
    <permission-map name="Field: Edit Sampling Date" acquired="True"/>
    <permission-map name="Field: Edit Sampling Deviation" acquired="True"/>
    <permission-map name="Field: Edit Sampling Round" acquired="True"/>
    <permission-map name="Field: Edit Scheduled Sampler" acquired="True"/>
    <permission-map name="Field: Edit Storage Location" acquired="True"/>
    <!-- Make the field 'Template' readonly -->
    <permission-map name="Field: Edit Template" acquired="False"/>
    <permission-map name="Field: Edit Specification" acquired="True"/>
    <!-- /MANAGED PERMISSIONS -->
  </state>
  <!-- /State: scheduled_sampling -->


  <!-- State: to_be_sampled
       NOTE: The sample reaches this status automatically upon creation (see
       to_be_sampled transition) -->
  <state state_id="to_be_sampled" title="To be sampled" i18n:attributes="title">
    <description>The Sample needs to be collected by laboratory personnel</description>

    <!-- TRANSITIONS -->
    <exit-transition transition_id="cancel"/>
    <exit-transition transition_id="sample"/>
    <exit-transition transition_id="submit"/>
    <exit-transition transition_id="schedule_sampling"/>
    <exit-transition transition_id="reject"/>
    <!-- /TRANSITIONS -->

    <!-- MANAGED PERMISSIONS -->
    <permission-map name="BIKA: Add Analysis" acquired="True"/>
    <permission-map name="BIKA: Add Attachment" acquired="True"/>
    <permission-map name="BIKA: Cancel and reinstate" acquired="True"/>
    <permission-map name="BIKA: Edit AR" acquired="True"/>
    <permission-map name="BIKA: Edit Field Results" acquired="True"/>
    <permission-map name="BIKA: Edit Results" acquired="True"/>
    <permission-map name="BIKA: Manage Invoices" acquired="True"/>
    <permission-map name="BIKA: Preserve Sample" acquired="True"/>
    <permission-map name="BIKA: Publish" acquired="True"/>
    <permission-map name="BIKA: Receive Sample" acquired="True"/>
    <permission-map name="BIKA: Sample Sample" acquired="True"/>
    <permission-map name="BIKA: Schedule Sampling" acquired="True"/>
    <permission-map name="BIKA: Verify" acquired="True"/>
    <permission-map name="BIKA: View Results" acquired="True"/>
    <permission-map name="Modify portal content" acquired="True"/>
    <permission-map name="Reject Analysis Request" acquired="True"/>
    <permission-map name="Verify" acquired="True"/>
    <permission-map name="View" acquired="True"/>
    <!-- Field Permissions -->
    <permission-map name="Field: Edit Batch" acquired="True"/>
    <permission-map name="Field: Edit Client Order Number" acquired="True"/>
    <permission-map name="Field: Edit Client Reference" acquired="True"/>
    <permission-map name="Field: Edit Client Sample ID" acquired="True"/>
    <permission-map name="Field: Edit Client" acquired="True"/>
    <permission-map name="Field: Edit Composite" acquired="True"/>
    <permission-map name="Field: Edit Contact" acquired="True"/>
    <permission-map name="Field: Edit Container" acquired="True"/>
    <permission-map name="Field: Edit Date Preserved" acquired="True"/>
    <permission-map name="Field: Edit Date Received" acquired="True"/>
    <permission-map name="Field: Edit Date Sampled" acquired="True"/>
    <permission-map name="Field: Edit Environmental Conditions" acquired="True"/>
    <permission-map name="Field: Edit Invoice Exclude" acquired="True"/>
    <permission-map name="Field: Edit Member Discount" acquired="True"/>
    <permission-map name="Field: Edit Preservation" acquired="True"/>
    <permission-map name="Field: Edit Preserver" acquired="True"/>
    <permission-map name="Field: Edit Priority" acquired="True"/>
    <!-- Make the field 'Profiles' readonly -->
    <permission-map name="Field: Edit Profiles" acquired="False"/>
    <permission-map name="Field: Edit Publication Specification" acquired="True"/>
    <permission-map name="Field: Edit Rejection Reasons" acquired="True"/>
    <permission-map name="Field: Edit Results Interpretation" acquired="True"/>
    <permission-map name="Field: Edit Sample Point" acquired="True"/>
    <!-- Make the field 'SampleType' readonly -->
    <permission-map name="Field: Edit Sample Type" acquired="False"/>
    <permission-map name="Field: Edit Sample Condition" acquired="True"/>
    <permission-map name="Field: Edit Sampler" acquired="True"/>
    <permission-map name="Field: Edit Sampling Date" acquired="True"/>
    <permission-map name="Field: Edit Sampling Deviation" acquired="True"/>
    <permission-map name="Field: Edit Sampling Round" acquired="True"/>
    <permission-map name="Field: Edit Scheduled Sampler" acquired="True"/>
    <permission-map name="Field: Edit Storage Location" acquired="True"/>
    <!-- Make the field 'Template' readonly -->
    <permission-map name="Field: Edit Template" acquired="False"/>
    <permission-map name="Field: Edit Specification" acquired="True"/>
    <!-- /MANAGED PERMISSIONS -->
  </state>
  <!-- /State: to_be_sampled -->


  <!-- State: sample_due -->
  <state state_id="sample_due" title="Sample due" i18n:attributes="title">
    <description>Waiting for the sample to be received</description>

    <!-- TRANSITIONS -->
    <exit-transition transition_id="cancel"/>
    <exit-transition transition_id="receive"/>
    <exit-transition transition_id="submit"/>
    <exit-transition transition_id="reject" />
    <!-- TRANSITIONS -->

    <!-- MANAGED PERMISSIONS -->
    <permission-map name="BIKA: Add Analysis" acquired="True"/>
    <permission-map name="BIKA: Add Attachment" acquired="True"/>
    <permission-map name="BIKA: Cancel and reinstate" acquired="True"/>
    <permission-map name="BIKA: Edit AR" acquired="True"/>
    <permission-map name="BIKA: Edit Field Results" acquired="True"/>
    <permission-map name="BIKA: Edit Results" acquired="True"/>
    <permission-map name="BIKA: Manage Invoices" acquired="True"/>
    <permission-map name="BIKA: Preserve Sample" acquired="True"/>
    <permission-map name="BIKA: Publish" acquired="True"/>
    <permission-map name="BIKA: Receive Sample" acquired="True"/>
    <permission-map name="BIKA: Sample Sample" acquired="True"/>
    <permission-map name="BIKA: Schedule Sampling" acquired="True"/>
    <permission-map name="BIKA: Verify" acquired="True"/>
    <permission-map name="BIKA: View Results" acquired="True"/>
    <permission-map name="Modify portal content" acquired="True"/>
    <permission-map name="Reject Analysis Request" acquired="True"/>
    <permission-map name="View" acquired="True"/>
    <!-- Field Permissions -->
    <permission-map name="Field: Edit Batch" acquired="True"/>
    <permission-map name="Field: Edit Client Order Number" acquired="True"/>
    <permission-map name="Field: Edit Client Reference" acquired="True"/>
    <permission-map name="Field: Edit Client Sample ID" acquired="True"/>
    <permission-map name="Field: Edit Client" acquired="True"/>
    <permission-map name="Field: Edit Composite" acquired="True"/>
    <permission-map name="Field: Edit Contact" acquired="True"/>
    <permission-map name="Field: Edit Container" acquired="True"/>
    <permission-map name="Field: Edit Date Preserved" acquired="True"/>
    <permission-map name="Field: Edit Date Received" acquired="True"/>
    <permission-map name="Field: Edit Date Sampled" acquired="True"/>
    <permission-map name="Field: Edit Environmental Conditions" acquired="True"/>
    <permission-map name="Field: Edit Invoice Exclude" acquired="True"/>
    <permission-map name="Field: Edit Member Discount" acquired="True"/>
    <permission-map name="Field: Edit Preservation" acquired="True"/>
    <permission-map name="Field: Edit Preserver" acquired="True"/>
    <permission-map name="Field: Edit Priority" acquired="True"/>
    <!-- Make the field 'Profiles' readonly -->
    <permission-map name="Field: Edit Profiles" acquired="False"/>
    <permission-map name="Field: Edit Publication Specification" acquired="True"/>
    <permission-map name="Field: Edit Rejection Reasons" acquired="True"/>
    <permission-map name="Field: Edit Results Interpretation" acquired="True"/>
    <permission-map name="Field: Edit Sample Point" acquired="True"/>
    <!-- Make the field 'SampleType' readonly -->
    <permission-map name="Field: Edit Sample Type" acquired="False"/>
    <permission-map name="Field: Edit Sample Condition" acquired="True"/>
    <permission-map name="Field: Edit Sampler" acquired="True"/>
    <permission-map name="Field: Edit Sampling Date" acquired="True"/>
    <permission-map name="Field: Edit Sampling Deviation" acquired="True"/>
    <permission-map name="Field: Edit Sampling Round" acquired="True"/>
    <permission-map name="Field: Edit Scheduled Sampler" acquired="True"/>
    <permission-map name="Field: Edit Storage Location" acquired="True"/>
    <!-- Make the field 'Template' readonly -->
    <permission-map name="Field: Edit Template" acquired="False"/>
    <permission-map name="Field: Edit Specification" acquired="True"/>
    <!-- /MANAGED PERMISSIONS -->
  </state>
  <!-- /State: sample_due -->


  <!-- State: sample_received -->
  <state state_id="sample_received" title="Received" i18n:attributes="title">
    <description>Sample was received by the laboratory</description>

    <!-- TRANSITIONS -->
    <exit-transition transition_id="cancel"/>
    <exit-transition transition_id="prepublish"/>
    <exit-transition transition_id="submit"/>
    <exit-transition transition_id="reject" />
    <exit-transition transition_id="create_partitions" />
    <!-- /TRANSITIONS -->

    <!-- MANAGED PERMISSIONS -->
    <permission-map name="BIKA: Add Analysis" acquired="True"/>
    <permission-map name="BIKA: Add Attachment" acquired="True"/>
    <permission-map name="BIKA: Cancel and reinstate" acquired="True"/>
    <permission-map name="BIKA: Edit AR" acquired="True"/>
    <permission-map name="BIKA: Edit Field Results" acquired="True"/>
    <permission-map name="BIKA: Edit Results" acquired="True"/>
    <permission-map name="BIKA: Manage Invoices" acquired="True"/>
    <permission-map name="BIKA: Preserve Sample" acquired="True"/>
    <permission-map name="BIKA: Publish" acquired="True"/>
    <permission-map name="BIKA: Receive Sample" acquired="True"/>
    <permission-map name="BIKA: Sample Sample" acquired="True"/>
    <permission-map name="BIKA: Schedule Sampling" acquired="True"/>
    <permission-map name="BIKA: Verify" acquired="True"/>
    <permission-map name="BIKA: View Results" acquired="True"/>
    <permission-map name="Modify portal content" acquired="True"/>
    <permission-map name="Reject Analysis Request" acquired="True"/>
    <permission-map name="View" acquired="True"/>
    <!-- Field Permissions -->
    <permission-map name="Field: Edit Batch" acquired="True"/>
    <permission-map name="Field: Edit Client Order Number" acquired="True"/>
    <permission-map name="Field: Edit Client Reference" acquired="True"/>
    <permission-map name="Field: Edit Client Sample ID" acquired="True"/>
    <permission-map name="Field: Edit Client" acquired="True"/>
    <permission-map name="Field: Edit Composite" acquired="True"/>
    <permission-map name="Field: Edit Contact" acquired="True"/>
    <permission-map name="Field: Edit Container" acquired="True"/>
    <permission-map name="Field: Edit Date Preserved" acquired="True"/>
    <permission-map name="Field: Edit Date Received" acquired="True"/>
    <permission-map name="Field: Edit Date Sampled" acquired="True"/>
    <permission-map name="Field: Edit Environmental Conditions" acquired="True"/>
    <permission-map name="Field: Edit Invoice Exclude" acquired="True"/>
    <permission-map name="Field: Edit Member Discount" acquired="True"/>
    <permission-map name="Field: Edit Preservation" acquired="True"/>
    <permission-map name="Field: Edit Preserver" acquired="True"/>
    <permission-map name="Field: Edit Priority" acquired="True"/>
    <!-- Make the field 'Profiles' readonly -->
    <permission-map name="Field: Edit Profiles" acquired="False"/>
    <permission-map name="Field: Edit Publication Specification" acquired="True"/>
    <permission-map name="Field: Edit Rejection Reasons" acquired="True"/>
    <permission-map name="Field: Edit Results Interpretation" acquired="True"/>
    <permission-map name="Field: Edit Sample Point" acquired="True"/>
    <!-- Make the field 'SampleType' readonly -->
    <permission-map name="Field: Edit Sample Type" acquired="False"/>
    <permission-map name="Field: Edit Sample Condition" acquired="True"/>
    <permission-map name="Field: Edit Sampler" acquired="True"/>
    <permission-map name="Field: Edit Sampling Date" acquired="True"/>
    <permission-map name="Field: Edit Sampling Deviation" acquired="True"/>
    <permission-map name="Field: Edit Sampling Round" acquired="True"/>
    <permission-map name="Field: Edit Scheduled Sampler" acquired="True"/>
    <permission-map name="Field: Edit Storage Location" acquired="True"/>
    <!-- Make the field 'Template' readonly -->
    <permission-map name="Field: Edit Template" acquired="False"/>
    <permission-map name="Field: Edit Specification" acquired="True"/>
    <!-- /MANAGED PERMISSIONS -->
  </state>
  <!-- State: sample_received -->


  <!-- State: attachment_due -->
  <state state_id="attachment_due" title="Attachment due" i18n:attributes="title">
    <description>Sample awaits for the attachment</description>

    <!-- TRANSITIONS -->
    <exit-transition transition_id="prepublish" />
    <exit-transition transition_id="attach" />
    <exit-transition transition_id="retract" />
    <exit-transition transition_id="reject" />
    <!-- TRANSITIONS -->

    <!-- MANAGED PERMISSIONS -->
    <permission-map name="BIKA: Add Analysis" acquired="True"/>
    <permission-map name="BIKA: Add Attachment" acquired="True"/>
    <permission-map name="BIKA: Cancel and reinstate" acquired="True"/>
    <permission-map name="BIKA: Edit AR" acquired="True"/>
    <permission-map name="BIKA: Edit Field Results" acquired="True"/>
    <permission-map name="BIKA: Edit Results" acquired="True"/>
    <permission-map name="BIKA: Manage Invoices" acquired="True"/>
    <permission-map name="BIKA: Preserve Sample" acquired="True"/>
    <permission-map name="BIKA: Publish" acquired="True"/>
    <permission-map name="BIKA: Receive Sample" acquired="True"/>
    <permission-map name="BIKA: Sample Sample" acquired="True"/>
    <permission-map name="BIKA: Schedule Sampling" acquired="True"/>
    <permission-map name="BIKA: Verify" acquired="True"/>
    <permission-map name="BIKA: View Results" acquired="True"/>
    <permission-map name="Modify portal content" acquired="True"/>
    <permission-map name="Reject Analysis Request" acquired="True"/>
    <permission-map name="View" acquired="True"/>
    <!-- Field Permissions -->
    <permission-map name="Field: Edit Batch" acquired="True"/>
    <permission-map name="Field: Edit Client Order Number" acquired="True"/>
    <permission-map name="Field: Edit Client Reference" acquired="True"/>
    <permission-map name="Field: Edit Client Sample ID" acquired="True"/>
    <permission-map name="Field: Edit Client" acquired="True"/>
    <permission-map name="Field: Edit Composite" acquired="True"/>
    <permission-map name="Field: Edit Contact" acquired="True"/>
    <permission-map name="Field: Edit Container" acquired="True"/>
    <permission-map name="Field: Edit Date Preserved" acquired="True"/>
    <permission-map name="Field: Edit Date Received" acquired="True"/>
    <permission-map name="Field: Edit Date Sampled" acquired="True"/>
    <permission-map name="Field: Edit Environmental Conditions" acquired="True"/>
    <permission-map name="Field: Edit Invoice Exclude" acquired="True"/>
    <permission-map name="Field: Edit Member Discount" acquired="True"/>
    <permission-map name="Field: Edit Preservation" acquired="True"/>
    <permission-map name="Field: Edit Preserver" acquired="True"/>
    <permission-map name="Field: Edit Priority" acquired="True"/>
    <!-- Make the field 'Profiles' readonly -->
    <permission-map name="Field: Edit Profiles" acquired="False"/>
    <permission-map name="Field: Edit Publication Specification" acquired="True"/>
    <permission-map name="Field: Edit Rejection Reasons" acquired="True"/>
    <permission-map name="Field: Edit Results Interpretation" acquired="True"/>
    <permission-map name="Field: Edit Sample Point" acquired="True"/>
    <!-- Make the field 'SampleType' readonly -->
    <permission-map name="Field: Edit Sample Type" acquired="False"/>
    <permission-map name="Field: Edit Sample Condition" acquired="True"/>
    <permission-map name="Field: Edit Sampler" acquired="True"/>
    <permission-map name="Field: Edit Sampling Date" acquired="True"/>
    <permission-map name="Field: Edit Sampling Deviation" acquired="True"/>
    <permission-map name="Field: Edit Sampling Round" acquired="True"/>
    <permission-map name="Field: Edit Scheduled Sampler" acquired="True"/>
    <permission-map name="Field: Edit Storage Location" acquired="True"/>
    <!-- Make the field 'Template' readonly -->
    <permission-map name="Field: Edit Template" acquired="False"/>
    <permission-map name="Field: Edit Specification" acquired="True"/>
    <!-- /MANAGED PERMISSIONS -->

  </state>
  <!-- /State: attachment_due -->


  <!-- State: to_be_preserved -->
  <state state_id="to_be_preserved" title="To be preserved" i18n:attributes="title">
    <description>Sample was identified as requiring preservation</description>

    <!-- TRANSITIONS -->
    <exit-transition transition_id="cancel"/>
    <exit-transition transition_id="preserve"/>
    <exit-transition transition_id="reject" />
    <!-- /TRANSITIONS -->

    <!-- MANAGED PERMISSIONS -->
    <permission-map name="BIKA: Add Analysis" acquired="True"/>
    <permission-map name="BIKA: Add Attachment" acquired="True"/>
    <permission-map name="BIKA: Cancel and reinstate" acquired="True"/>
    <permission-map name="BIKA: Edit AR" acquired="True"/>
    <permission-map name="BIKA: Edit Field Results" acquired="True"/>
    <permission-map name="BIKA: Edit Results" acquired="True"/>
    <permission-map name="BIKA: Manage Invoices" acquired="True"/>
    <permission-map name="BIKA: Preserve Sample" acquired="True"/>
    <permission-map name="BIKA: Publish" acquired="True"/>
    <permission-map name="BIKA: Receive Sample" acquired="True"/>
    <permission-map name="BIKA: Sample Sample" acquired="True"/>
    <permission-map name="BIKA: Schedule Sampling" acquired="True"/>
    <permission-map name="BIKA: Verify" acquired="True"/>
    <permission-map name="BIKA: View Results" acquired="True"/>
    <permission-map name="Modify portal content" acquired="True"/>
    <permission-map name="Reject Analysis Request" acquired="True"/>
    <permission-map name="View" acquired="True"/>
    <!-- Field Permissions -->
    <permission-map name="Field: Edit Batch" acquired="True"/>
    <permission-map name="Field: Edit Client Order Number" acquired="True"/>
    <permission-map name="Field: Edit Client Reference" acquired="True"/>
    <permission-map name="Field: Edit Client Sample ID" acquired="True"/>
    <permission-map name="Field: Edit Client" acquired="True"/>
    <permission-map name="Field: Edit Composite" acquired="True"/>
    <permission-map name="Field: Edit Contact" acquired="True"/>
    <permission-map name="Field: Edit Container" acquired="True"/>
    <permission-map name="Field: Edit Date Preserved" acquired="True"/>
    <permission-map name="Field: Edit Date Received" acquired="True"/>
    <permission-map name="Field: Edit Date Sampled" acquired="True"/>
    <permission-map name="Field: Edit Environmental Conditions" acquired="True"/>
    <permission-map name="Field: Edit Invoice Exclude" acquired="True"/>
    <permission-map name="Field: Edit Member Discount" acquired="True"/>
    <permission-map name="Field: Edit Preservation" acquired="True"/>
    <permission-map name="Field: Edit Preserver" acquired="True"/>
    <permission-map name="Field: Edit Priority" acquired="True"/>
    <!-- Make the field 'Profiles' readonly -->
    <permission-map name="Field: Edit Profiles" acquired="False"/>
    <permission-map name="Field: Edit Publication Specification" acquired="True"/>
    <permission-map name="Field: Edit Rejection Reasons" acquired="True"/>
    <permission-map name="Field: Edit Results Interpretation" acquired="True"/>
    <permission-map name="Field: Edit Sample Point" acquired="True"/>
    <!-- Make the field 'SampleType' readonly -->
    <permission-map name="Field: Edit Sample Type" acquired="False"/>
    <permission-map name="Field: Edit Sample Condition" acquired="True"/>
    <permission-map name="Field: Edit Sampler" acquired="True"/>
    <permission-map name="Field: Edit Sampling Date" acquired="True"/>
    <permission-map name="Field: Edit Sampling Deviation" acquired="True"/>
    <permission-map name="Field: Edit Sampling Round" acquired="True"/>
    <permission-map name="Field: Edit Scheduled Sampler" acquired="True"/>
    <permission-map name="Field: Edit Storage Location" acquired="True"/>
    <!-- Make the field 'Template' readonly -->
    <permission-map name="Field: Edit Template" acquired="False"/>
    <permission-map name="Field: Edit Specification" acquired="True"/>
    <!-- /MANAGED PERMISSIONS -->
  </state>
  <!-- /State: to_be_preserved -->


  <!-- /State: to_be_verified -->
  <state state_id="to_be_verified" title="To be verified" i18n:attributes="title">
    <description>Results are submitted for verification</description>

    <!-- TRANSITIONS -->
    <exit-transition transition_id="prepublish" />
    <exit-transition transition_id="verify" />
    <exit-transition transition_id="retract" />
    <exit-transition transition_id="reject" />
    <exit-transition transition_id="rollback_to_receive" />
    <!-- /TRANSITIONS -->

    <!-- MANAGED PERMISSIONS -->
    <permission-map name="BIKA: Add Analysis" acquired="True"/>
    <permission-map name="BIKA: Add Attachment" acquired="True"/>
    <permission-map name="BIKA: Cancel and reinstate" acquired="True"/>
    <permission-map name="BIKA: Edit AR" acquired="True"/>
    <permission-map name="BIKA: Edit Field Results" acquired="True"/>
    <permission-map name="BIKA: Edit Results" acquired="True"/>
    <permission-map name="BIKA: Manage Invoices" acquired="True"/>
    <permission-map name="BIKA: Preserve Sample" acquired="True"/>
    <permission-map name="BIKA: Publish" acquired="True"/>
    <permission-map name="BIKA: Receive Sample" acquired="True"/>
    <permission-map name="BIKA: Sample Sample" acquired="True"/>
    <permission-map name="BIKA: Schedule Sampling" acquired="True"/>
    <permission-map name="BIKA: Verify" acquired="True"/>
    <permission-map name="BIKA: View Results" acquired="True"/>
    <permission-map name="Modify portal content" acquired="True"/>
    <permission-map name="Reject Analysis Request" acquired="True"/>
    <permission-map name="View" acquired="True"/>
    <!-- Field Permissions -->
    <permission-map name="Field: Edit Batch" acquired="True"/>
    <permission-map name="Field: Edit Client Order Number" acquired="True"/>
    <permission-map name="Field: Edit Client Reference" acquired="True"/>
    <permission-map name="Field: Edit Client Sample ID" acquired="True"/>
    <permission-map name="Field: Edit Client" acquired="True"/>
    <permission-map name="Field: Edit Composite" acquired="True"/>
    <permission-map name="Field: Edit Contact" acquired="True"/>
    <permission-map name="Field: Edit Container" acquired="True"/>
    <permission-map name="Field: Edit Date Preserved" acquired="True"/>
    <permission-map name="Field: Edit Date Received" acquired="True"/>
    <permission-map name="Field: Edit Date Sampled" acquired="True"/>
    <permission-map name="Field: Edit Environmental Conditions" acquired="True"/>
    <permission-map name="Field: Edit Invoice Exclude" acquired="True"/>
    <permission-map name="Field: Edit Member Discount" acquired="True"/>
    <permission-map name="Field: Edit Preservation" acquired="True"/>
    <permission-map name="Field: Edit Preserver" acquired="True"/>
    <permission-map name="Field: Edit Priority" acquired="True"/>
    <!-- Make the field 'Profiles' readonly -->
    <permission-map name="Field: Edit Profiles" acquired="False"/>
    <permission-map name="Field: Edit Publication Specification" acquired="True"/>
    <permission-map name="Field: Edit Rejection Reasons" acquired="True"/>
    <permission-map name="Field: Edit Results Interpretation" acquired="True"/>
    <permission-map name="Field: Edit Sample Point" acquired="True"/>
    <!-- Make the field 'SampleType' readonly -->
    <permission-map name="Field: Edit Sample Type" acquired="False"/>
    <permission-map name="Field: Edit Sample Condition" acquired="True"/>
    <permission-map name="Field: Edit Sampler" acquired="True"/>
    <permission-map name="Field: Edit Sampling Date" acquired="True"/>
    <permission-map name="Field: Edit Sampling Deviation" acquired="True"/>
    <permission-map name="Field: Edit Sampling Round" acquired="True"/>
    <permission-map name="Field: Edit Scheduled Sampler" acquired="True"/>
    <permission-map name="Field: Edit Storage Location" acquired="True"/>
    <!-- Make the field 'Template' readonly -->
    <permission-map name="Field: Edit Template" acquired="False"/>
    <permission-map name="Field: Edit Specification" acquired="True"/>
    <!-- /MANAGED PERMISSIONS -->
  </state>
  <!-- State: sample_received -->


  <!-- State: attachment_due -->
  <state state_id="attachment_due" title="Attachment due" i18n:attributes="title">
    <description>Sample awaits for the attachment</description>

    <!-- TRANSITIONS -->
    <exit-transition transition_id="prepublish" />
    <exit-transition transition_id="attach" />
    <exit-transition transition_id="retract" />
    <exit-transition transition_id="reject" />
    <!-- TRANSITIONS -->

    <!-- MANAGED PERMISSIONS -->
    <permission-map name="BIKA: Add Analysis" acquired="True"/>
    <permission-map name="BIKA: Add Attachment" acquired="True"/>
    <permission-map name="BIKA: Cancel and reinstate" acquired="True"/>
    <permission-map name="BIKA: Edit AR" acquired="True"/>
    <permission-map name="BIKA: Edit Field Results" acquired="True"/>
    <permission-map name="BIKA: Edit Results" acquired="True"/>
    <permission-map name="BIKA: Manage Invoices" acquired="True"/>
    <permission-map name="BIKA: Preserve Sample" acquired="True"/>
    <permission-map name="BIKA: Publish" acquired="True"/>
    <permission-map name="BIKA: Receive Sample" acquired="True"/>
    <permission-map name="BIKA: Sample Sample" acquired="True"/>
    <permission-map name="BIKA: Schedule Sampling" acquired="True"/>
    <permission-map name="BIKA: Verify" acquired="True"/>
    <permission-map name="BIKA: View Results" acquired="True"/>
    <permission-map name="Modify portal content" acquired="True"/>
    <permission-map name="Reject Analysis Request" acquired="True"/>
    <permission-map name="View" acquired="True"/>
    <!-- Field Permissions -->
    <permission-map name="Field: Edit Batch" acquired="True"/>
    <permission-map name="Field: Edit Client Order Number" acquired="True"/>
    <permission-map name="Field: Edit Client Reference" acquired="True"/>
    <permission-map name="Field: Edit Client Sample ID" acquired="True"/>
    <permission-map name="Field: Edit Client" acquired="True"/>
    <permission-map name="Field: Edit Composite" acquired="True"/>
    <permission-map name="Field: Edit Contact" acquired="True"/>
    <permission-map name="Field: Edit Container" acquired="True"/>
    <permission-map name="Field: Edit Date Preserved" acquired="True"/>
    <permission-map name="Field: Edit Date Received" acquired="True"/>
    <permission-map name="Field: Edit Date Sampled" acquired="True"/>
    <permission-map name="Field: Edit Environmental Conditions" acquired="True"/>
    <permission-map name="Field: Edit Invoice Exclude" acquired="True"/>
    <permission-map name="Field: Edit Member Discount" acquired="True"/>
    <permission-map name="Field: Edit Preservation" acquired="True"/>
    <permission-map name="Field: Edit Preserver" acquired="True"/>
    <permission-map name="Field: Edit Priority" acquired="True"/>
    <!-- Make the field 'Profiles' readonly -->
    <permission-map name="Field: Edit Profiles" acquired="False"/>
    <permission-map name="Field: Edit Publication Specification" acquired="True"/>
    <permission-map name="Field: Edit Rejection Reasons" acquired="True"/>
    <permission-map name="Field: Edit Results Interpretation" acquired="True"/>
    <permission-map name="Field: Edit Sample Point" acquired="True"/>
    <!-- Make the field 'SampleType' readonly -->
    <permission-map name="Field: Edit Sample Type" acquired="False"/>
    <permission-map name="Field: Edit Sample Condition" acquired="True"/>
    <permission-map name="Field: Edit Sampler" acquired="True"/>
    <permission-map name="Field: Edit Sampling Date" acquired="True"/>
    <permission-map name="Field: Edit Sampling Deviation" acquired="True"/>
    <permission-map name="Field: Edit Sampling Round" acquired="True"/>
    <permission-map name="Field: Edit Scheduled Sampler" acquired="True"/>
    <permission-map name="Field: Edit Storage Location" acquired="True"/>
    <!-- Make the field 'Template' readonly -->
    <permission-map name="Field: Edit Template" acquired="False"/>
    <permission-map name="Field: Edit Specification" acquired="True"/>
    <!-- /MANAGED PERMISSIONS -->
  </state>
  <!-- /State: attachment_due -->


  <!-- State: to_be_preserved -->
  <state state_id="to_be_preserved" title="To be preserved" i18n:attributes="title">
    <description>Sample was identified as requiring preservation</description>

    <!-- TRANSITIONS -->
    <exit-transition transition_id="cancel"/>
    <exit-transition transition_id="preserve"/>
    <exit-transition transition_id="reject" />
    <!-- /TRANSITIONS -->

    <!-- MANAGED PERMISSIONS -->
    <permission-map name="BIKA: Add Analysis" acquired="True"/>
    <permission-map name="BIKA: Add Attachment" acquired="True"/>
    <permission-map name="BIKA: Cancel and reinstate" acquired="True"/>
    <permission-map name="BIKA: Edit AR" acquired="True"/>
    <permission-map name="BIKA: Edit Field Results" acquired="True"/>
    <permission-map name="BIKA: Edit Results" acquired="True"/>
    <permission-map name="BIKA: Manage Invoices" acquired="True"/>
    <permission-map name="BIKA: Preserve Sample" acquired="True"/>
    <permission-map name="BIKA: Publish" acquired="True"/>
    <permission-map name="BIKA: Receive Sample" acquired="True"/>
    <permission-map name="BIKA: Sample Sample" acquired="True"/>
    <permission-map name="BIKA: Schedule Sampling" acquired="True"/>
    <permission-map name="BIKA: Verify" acquired="True"/>
    <permission-map name="BIKA: View Results" acquired="True"/>
    <permission-map name="Modify portal content" acquired="True"/>
    <permission-map name="Reject Analysis Request" acquired="True"/>
    <permission-map name="View" acquired="True"/>
    <!-- Field Permissions -->
    <permission-map name="Field: Edit Batch" acquired="True"/>
    <permission-map name="Field: Edit Client Order Number" acquired="True"/>
    <permission-map name="Field: Edit Client Reference" acquired="True"/>
    <permission-map name="Field: Edit Client Sample ID" acquired="True"/>
    <permission-map name="Field: Edit Client" acquired="True"/>
    <permission-map name="Field: Edit Composite" acquired="True"/>
    <permission-map name="Field: Edit Contact" acquired="True"/>
    <permission-map name="Field: Edit Container" acquired="True"/>
    <permission-map name="Field: Edit Date Preserved" acquired="True"/>
    <permission-map name="Field: Edit Date Received" acquired="True"/>
    <permission-map name="Field: Edit Date Sampled" acquired="True"/>
    <permission-map name="Field: Edit Environmental Conditions" acquired="True"/>
    <permission-map name="Field: Edit Invoice Exclude" acquired="True"/>
    <permission-map name="Field: Edit Member Discount" acquired="True"/>
    <permission-map name="Field: Edit Preservation" acquired="True"/>
    <permission-map name="Field: Edit Preserver" acquired="True"/>
    <permission-map name="Field: Edit Priority" acquired="True"/>
    <!-- Make the field 'Profiles' readonly -->
    <permission-map name="Field: Edit Profiles" acquired="False"/>
    <permission-map name="Field: Edit Publication Specification" acquired="True"/>
    <permission-map name="Field: Edit Rejection Reasons" acquired="True"/>
    <permission-map name="Field: Edit Results Interpretation" acquired="True"/>
    <permission-map name="Field: Edit Sample Point" acquired="True"/>
    <!-- Make the field 'SampleType' readonly -->
    <permission-map name="Field: Edit Sample Type" acquired="False"/>
    <permission-map name="Field: Edit Sample Condition" acquired="True"/>
    <permission-map name="Field: Edit Sampler" acquired="True"/>
    <permission-map name="Field: Edit Sampling Date" acquired="True"/>
    <permission-map name="Field: Edit Sampling Deviation" acquired="True"/>
    <permission-map name="Field: Edit Sampling Round" acquired="True"/>
    <permission-map name="Field: Edit Scheduled Sampler" acquired="True"/>
    <permission-map name="Field: Edit Storage Location" acquired="True"/>
    <!-- Make the field 'Template' readonly -->
    <permission-map name="Field: Edit Template" acquired="False"/>
    <permission-map name="Field: Edit Specification" acquired="True"/>
    <!-- /MANAGED PERMISSIONS -->
  </state>
  <!-- /State: to_be_verified -->


  <!-- State: verified -->
  <state state_id="verified" title="Verified" i18n:attributes="title">
    <description>Results are verified</description>

    <!-- TRANSITIONS -->
    <exit-transition transition_id="publish" />
    <exit-transition transition_id="invalidate" />
    <exit-transition transition_id="rollback_to_receive" />
    <!-- /TRANSITIONS -->

    <!-- MANAGED PERMISSIONS (partially readonly) -->

    <!-- Hide the 'Manage Analyses' tab -->
    <permission-map name="BIKA: Add Analysis" acquired="False"/>
    <permission-map name="BIKA: Add Attachment" acquired="True"/>
    <permission-map name="BIKA: Cancel and reinstate" acquired="True"/>
    <permission-map name="BIKA: Edit AR" acquired="True"/>
    <!-- Hide the 'Manage Results' tab -->
    <permission-map name="BIKA: Edit Field Results" acquired="False"/>
    <permission-map name="BIKA: Edit Results" acquired="False"/>
    <permission-map name="BIKA: Manage Invoices" acquired="True"/>
    <permission-map name="BIKA: Preserve Sample" acquired="True"/>
    <permission-map name="BIKA: Publish" acquired="True"/>
    <permission-map name="BIKA: Receive Sample" acquired="True"/>
    <permission-map name="BIKA: Sample Sample" acquired="True"/>
    <permission-map name="BIKA: Schedule Sampling" acquired="True"/>
    <permission-map name="BIKA: Verify" acquired="True"/>
    <permission-map name="BIKA: View Results" acquired="True"/>
    <permission-map name="Modify portal content" acquired="True"/>
    <permission-map name="Reject Analysis Request" acquired="False"/>
    <permission-map name="View" acquired="True"/>
    <!-- Field Permissions (all readonly) -->
    <permission-map name="Field: Edit Batch" acquired="False"/>
    <permission-map name="Field: Edit Client Order Number" acquired="False"/>
    <permission-map name="Field: Edit Client Reference" acquired="False"/>
    <permission-map name="Field: Edit Client Sample ID" acquired="False"/>
    <permission-map name="Field: Edit Client" acquired="False"/>
    <permission-map name="Field: Edit Composite" acquired="False"/>
    <permission-map name="Field: Edit Contact" acquired="False"/>
    <permission-map name="Field: Edit Container" acquired="False"/>
    <permission-map name="Field: Edit Date Preserved" acquired="False"/>
    <permission-map name="Field: Edit Date Received" acquired="False"/>
    <permission-map name="Field: Edit Date Sampled" acquired="False"/>
    <permission-map name="Field: Edit Environmental Conditions" acquired="False"/>
    <permission-map name="Field: Edit Invoice Exclude" acquired="False"/>
    <permission-map name="Field: Edit Member Discount" acquired="False"/>
    <permission-map name="Field: Edit Preservation" acquired="False"/>
    <permission-map name="Field: Edit Preserver" acquired="False"/>
    <permission-map name="Field: Edit Priority" acquired="False"/>
    <permission-map name="Field: Edit Profiles" acquired="False"/>
    <permission-map name="Field: Edit Publication Specification" acquired="False"/>
    <permission-map name="Field: Edit Rejection Reasons" acquired="False"/>
    <permission-map name="Field: Edit Results Interpretation" acquired="False"/>
    <permission-map name="Field: Edit Sample Point" acquired="False"/>
    <permission-map name="Field: Edit Sample Type" acquired="False"/>
    <permission-map name="Field: Edit Sample Condition" acquired="False"/>
    <permission-map name="Field: Edit Sampler" acquired="False"/>
    <permission-map name="Field: Edit Sampling Date" acquired="False"/>
    <permission-map name="Field: Edit Sampling Deviation" acquired="False"/>
    <permission-map name="Field: Edit Sampling Round" acquired="False"/>
    <permission-map name="Field: Edit Scheduled Sampler" acquired="False"/>
    <permission-map name="Field: Edit Storage Location" acquired="False"/>
    <permission-map name="Field: Edit Template" acquired="False"/>
    <permission-map name="Field: Edit Specification" acquired="False"/>
    <!-- /MANAGED PERMISSIONS -->
  </state>
  <!-- /State: verified -->


  <!-- /State: published -->
  <state state_id="published" title="Published" i18n:attributes="title">
    <description>Results published and sent to the client</description>

    <!-- TRANSITIONS -->
    <exit-transition transition_id="republish"/>
    <exit-transition transition_id="invalidate"/>
    <!-- /TRANSITIONS -->

    <!-- MANAGED PERMISSIONS (partially readonly) -->

    <!-- Hide the 'Manage Analyses' tab -->
    <permission-map name="BIKA: Add Analysis" acquired="False"/>
    <permission-map name="BIKA: Add Attachment" acquired="True"/>
    <permission-map name="BIKA: Cancel and reinstate" acquired="True"/>
    <permission-map name="BIKA: Edit AR" acquired="True"/>
    <!-- Hide the 'Manage Results' tab -->
    <permission-map name="BIKA: Edit Field Results" acquired="False"/>
    <permission-map name="BIKA: Edit Results" acquired="False"/>
    <permission-map name="BIKA: Manage Invoices" acquired="True"/>
    <permission-map name="BIKA: Preserve Sample" acquired="True"/>
    <permission-map name="BIKA: Publish" acquired="True"/>
    <permission-map name="BIKA: Receive Sample" acquired="True"/>
    <permission-map name="BIKA: Sample Sample" acquired="True"/>
    <permission-map name="BIKA: Schedule Sampling" acquired="True"/>
    <permission-map name="BIKA: Verify" acquired="True"/>
    <permission-map name="BIKA: View Results" acquired="True"/>
    <permission-map name="Modify portal content" acquired="True"/>
    <permission-map name="Reject Analysis Request" acquired="True"/>
    <permission-map name="View" acquired="True"/>
    <!-- Field Permissions (all readonly) -->
    <permission-map name="Field: Edit Batch" acquired="False"/>
    <permission-map name="Field: Edit Client Order Number" acquired="False"/>
    <permission-map name="Field: Edit Client Reference" acquired="False"/>
    <permission-map name="Field: Edit Client Sample ID" acquired="False"/>
    <permission-map name="Field: Edit Client" acquired="False"/>
    <permission-map name="Field: Edit Composite" acquired="False"/>
    <permission-map name="Field: Edit Contact" acquired="False"/>
    <permission-map name="Field: Edit Container" acquired="False"/>
    <permission-map name="Field: Edit Date Preserved" acquired="False"/>
    <permission-map name="Field: Edit Date Received" acquired="False"/>
    <permission-map name="Field: Edit Date Sampled" acquired="False"/>
    <permission-map name="Field: Edit Environmental Conditions" acquired="False"/>
    <permission-map name="Field: Edit Invoice Exclude" acquired="False"/>
    <permission-map name="Field: Edit Member Discount" acquired="False"/>
    <permission-map name="Field: Edit Preservation" acquired="False"/>
    <permission-map name="Field: Edit Preserver" acquired="False"/>
    <permission-map name="Field: Edit Priority" acquired="False"/>
    <permission-map name="Field: Edit Profiles" acquired="False"/>
    <permission-map name="Field: Edit Publication Specification" acquired="False"/>
    <permission-map name="Field: Edit Rejection Reasons" acquired="False"/>
    <permission-map name="Field: Edit Results Interpretation" acquired="False"/>
    <permission-map name="Field: Edit Sample Point" acquired="False"/>
    <permission-map name="Field: Edit Sample Type" acquired="False"/>
    <permission-map name="Field: Edit Sample Condition" acquired="False"/>
    <permission-map name="Field: Edit Sampler" acquired="False"/>
    <permission-map name="Field: Edit Sampling Date" acquired="False"/>
    <permission-map name="Field: Edit Sampling Deviation" acquired="False"/>
    <permission-map name="Field: Edit Sampling Round" acquired="False"/>
    <permission-map name="Field: Edit Scheduled Sampler" acquired="False"/>
    <permission-map name="Field: Edit Storage Location" acquired="False"/>
    <permission-map name="Field: Edit Template" acquired="False"/>
    <permission-map name="Field: Edit Specification" acquired="False"/>
    <!-- /MANAGED PERMISSIONS -->
  </state>
  <!-- /State: published -->


  <!-- State: rejected -->
  <state state_id="rejected" title="Rejected" i18n:attributes="title">
    <description>Sample was rejected</description>

    <!-- TRANSITIONS -->
    <exit-transition transition_id="" />
    <!-- /TRANSITIONS -->

    <!-- MANAGED PERMISSIONS (partially readonly) -->

    <!-- Hide the 'Manage Analyses' tab -->
    <permission-map name="BIKA: Add Analysis" acquired="False"/>
    <permission-map name="BIKA: Add Attachment" acquired="True"/>
    <permission-map name="BIKA: Cancel and reinstate" acquired="True"/>
    <permission-map name="BIKA: Edit AR" acquired="True"/>
    <!-- Hide the 'Manage Results' tab -->
    <permission-map name="BIKA: Edit Field Results" acquired="False"/>
    <permission-map name="BIKA: Edit Results" acquired="False"/>
    <permission-map name="BIKA: Manage Invoices" acquired="True"/>
    <permission-map name="BIKA: Preserve Sample" acquired="True"/>
    <permission-map name="BIKA: Publish" acquired="True"/>
    <permission-map name="BIKA: Receive Sample" acquired="True"/>
    <permission-map name="BIKA: Sample Sample" acquired="True"/>
    <permission-map name="BIKA: Schedule Sampling" acquired="True"/>
    <permission-map name="BIKA: Verify" acquired="True"/>
    <permission-map name="BIKA: View Results" acquired="True"/>
    <permission-map name="Modify portal content" acquired="True"/>
    <permission-map name="Reject Analysis Request" acquired="True"/>
    <permission-map name="View" acquired="True"/>
    <!-- Field Permissions (all readonly) -->
    <permission-map name="Field: Edit Batch" acquired="False"/>
    <permission-map name="Field: Edit Client Order Number" acquired="False"/>
    <permission-map name="Field: Edit Client Reference" acquired="False"/>
    <permission-map name="Field: Edit Client Sample ID" acquired="False"/>
    <permission-map name="Field: Edit Client" acquired="False"/>
    <permission-map name="Field: Edit Composite" acquired="False"/>
    <permission-map name="Field: Edit Contact" acquired="False"/>
    <permission-map name="Field: Edit Container" acquired="False"/>
    <permission-map name="Field: Edit Date Preserved" acquired="False"/>
    <permission-map name="Field: Edit Date Received" acquired="False"/>
    <permission-map name="Field: Edit Date Sampled" acquired="False"/>
    <permission-map name="Field: Edit Environmental Conditions" acquired="False"/>
    <permission-map name="Field: Edit Invoice Exclude" acquired="False"/>
    <permission-map name="Field: Edit Member Discount" acquired="False"/>
    <permission-map name="Field: Edit Preservation" acquired="False"/>
    <permission-map name="Field: Edit Preserver" acquired="False"/>
    <permission-map name="Field: Edit Priority" acquired="False"/>
    <permission-map name="Field: Edit Profiles" acquired="False"/>
    <permission-map name="Field: Edit Publication Specification" acquired="False"/>
    <permission-map name="Field: Edit Rejection Reasons" acquired="False"/>
    <permission-map name="Field: Edit Results Interpretation" acquired="False"/>
    <permission-map name="Field: Edit Sample Point" acquired="False"/>
    <permission-map name="Field: Edit Sample Type" acquired="False"/>
    <permission-map name="Field: Edit Sample Condition" acquired="False"/>
    <permission-map name="Field: Edit Sampler" acquired="False"/>
    <permission-map name="Field: Edit Sampling Date" acquired="False"/>
    <permission-map name="Field: Edit Sampling Deviation" acquired="False"/>
    <permission-map name="Field: Edit Sampling Round" acquired="False"/>
    <permission-map name="Field: Edit Scheduled Sampler" acquired="False"/>
    <permission-map name="Field: Edit Storage Location" acquired="False"/>
    <permission-map name="Field: Edit Template" acquired="False"/>
    <permission-map name="Field: Edit Specification" acquired="False"/>
    <!-- /MANAGED PERMISSIONS -->
  </state>
  <!-- /State: rejected -->


  <!-- /State: invalid -->
  <state state_id="invalid" title="Invalid" i18n:attributes="title">
    <description>Published results were invalidated</description>

    <!-- TRANSITIONS -->
    <exit-transition transition_id=""/>
    <!-- /TRANSITIONS -->

    <!-- MANAGED PERMISSIONS (partially readonly) -->

    <!-- Hide the 'Manage Analyses' tab -->
    <permission-map name="BIKA: Add Analysis" acquired="False"/>
    <permission-map name="BIKA: Add Attachment" acquired="True"/>
    <permission-map name="BIKA: Cancel and reinstate" acquired="True"/>
    <permission-map name="BIKA: Edit AR" acquired="True"/>
    <!-- Hide the 'Manage Results' tab -->
    <permission-map name="BIKA: Edit Field Results" acquired="False"/>
    <permission-map name="BIKA: Edit Results" acquired="False"/>
    <permission-map name="BIKA: Manage Invoices" acquired="True"/>
    <permission-map name="BIKA: Preserve Sample" acquired="True"/>
    <permission-map name="BIKA: Publish" acquired="True"/>
    <permission-map name="BIKA: Receive Sample" acquired="True"/>
    <permission-map name="BIKA: Sample Sample" acquired="True"/>
    <permission-map name="BIKA: Schedule Sampling" acquired="True"/>
    <permission-map name="BIKA: Verify" acquired="True"/>
    <permission-map name="BIKA: View Results" acquired="True"/>
    <permission-map name="Modify portal content" acquired="True"/>
    <permission-map name="Reject Analysis Request" acquired="True"/>
    <permission-map name="View" acquired="True"/>
    <!-- Field Permissions (all readonly) -->
    <permission-map name="Field: Edit Batch" acquired="False"/>
    <permission-map name="Field: Edit Client Order Number" acquired="False"/>
    <permission-map name="Field: Edit Client Reference" acquired="False"/>
    <permission-map name="Field: Edit Client Sample ID" acquired="False"/>
    <permission-map name="Field: Edit Client" acquired="False"/>
    <permission-map name="Field: Edit Composite" acquired="False"/>
    <permission-map name="Field: Edit Contact" acquired="False"/>
    <permission-map name="Field: Edit Container" acquired="False"/>
    <permission-map name="Field: Edit Date Preserved" acquired="False"/>
    <permission-map name="Field: Edit Date Received" acquired="False"/>
    <permission-map name="Field: Edit Date Sampled" acquired="False"/>
    <permission-map name="Field: Edit Environmental Conditions" acquired="False"/>
    <permission-map name="Field: Edit Invoice Exclude" acquired="False"/>
    <permission-map name="Field: Edit Member Discount" acquired="False"/>
    <permission-map name="Field: Edit Preservation" acquired="False"/>
    <permission-map name="Field: Edit Preserver" acquired="False"/>
    <permission-map name="Field: Edit Priority" acquired="False"/>
    <permission-map name="Field: Edit Profiles" acquired="False"/>
    <permission-map name="Field: Edit Publication Specification" acquired="False"/>
    <permission-map name="Field: Edit Rejection Reasons" acquired="False"/>
    <permission-map name="Field: Edit Results Interpretation" acquired="False"/>
    <permission-map name="Field: Edit Sample Point" acquired="False"/>
    <permission-map name="Field: Edit Sample Type" acquired="False"/>
    <permission-map name="Field: Edit Sample Condition" acquired="False"/>
    <permission-map name="Field: Edit Sampler" acquired="False"/>
    <permission-map name="Field: Edit Sampling Date" acquired="False"/>
    <permission-map name="Field: Edit Sampling Deviation" acquired="False"/>
    <permission-map name="Field: Edit Sampling Round" acquired="False"/>
    <permission-map name="Field: Edit Scheduled Sampler" acquired="False"/>
    <permission-map name="Field: Edit Storage Location" acquired="False"/>
    <permission-map name="Field: Edit Template" acquired="False"/>
    <permission-map name="Field: Edit Specification" acquired="False"/>
    <!-- /MANAGED PERMISSIONS -->
  </state>
  <!-- /State: invalid -->


  <!-- State: cancelled
       This Analysis Request has been cancelled. Cancellation can be understood as
       a request the client did not want to submit or did it wrong. Hence, with
       cancellation, no notifications to involved personnel are sent and the request
       is no longer considered anywhere. Cancellation can only be performed when no
       results have been submitted yet. -->
  <state state_id="cancelled" title="Cancelled" i18n:attributes="title">
    <description>Sample was cancelled by the laboratory</description>

    <!-- TRANSITIONS -->
    <exit-transition transition_id="reinstate" />
    <!-- /TRANSITIONS -->

    <!-- MANAGED PERMISSIONS (partially readonly) -->

    <!-- Hide the 'Manage Analyses' tab -->
    <permission-map name="BIKA: Add Analysis" acquired="False"/>
    <permission-map name="BIKA: Add Attachment" acquired="True"/>
    <permission-map name="BIKA: Cancel and reinstate" acquired="True"/>
    <permission-map name="BIKA: Edit AR" acquired="True"/>
    <!-- Hide the 'Manage Results' tab -->
    <permission-map name="BIKA: Edit Field Results" acquired="False"/>
    <permission-map name="BIKA: Edit Results" acquired="False"/>
    <permission-map name="BIKA: Manage Invoices" acquired="True"/>
    <permission-map name="BIKA: Preserve Sample" acquired="True"/>
    <permission-map name="BIKA: Publish" acquired="True"/>
    <permission-map name="BIKA: Receive Sample" acquired="True"/>
    <permission-map name="BIKA: Sample Sample" acquired="True"/>
    <permission-map name="BIKA: Schedule Sampling" acquired="True"/>
    <permission-map name="BIKA: Verify" acquired="True"/>
    <permission-map name="BIKA: View Results" acquired="True"/>
    <permission-map name="Modify portal content" acquired="True"/>
    <permission-map name="Reject Analysis Request" acquired="True"/>
    <permission-map name="View" acquired="True"/>
    <!-- Field Permissions (all readonly) -->
    <permission-map name="Field: Edit Batch" acquired="False"/>
    <permission-map name="Field: Edit Client Order Number" acquired="False"/>
    <permission-map name="Field: Edit Client Reference" acquired="False"/>
    <permission-map name="Field: Edit Client Sample ID" acquired="False"/>
    <permission-map name="Field: Edit Client" acquired="False"/>
    <permission-map name="Field: Edit Composite" acquired="False"/>
    <permission-map name="Field: Edit Contact" acquired="False"/>
    <permission-map name="Field: Edit Container" acquired="False"/>
    <permission-map name="Field: Edit Date Preserved" acquired="False"/>
    <permission-map name="Field: Edit Date Received" acquired="False"/>
    <permission-map name="Field: Edit Date Sampled" acquired="False"/>
    <permission-map name="Field: Edit Environmental Conditions" acquired="False"/>
    <permission-map name="Field: Edit Invoice Exclude" acquired="False"/>
    <permission-map name="Field: Edit Member Discount" acquired="False"/>
    <permission-map name="Field: Edit Preservation" acquired="False"/>
    <permission-map name="Field: Edit Preserver" acquired="False"/>
    <permission-map name="Field: Edit Priority" acquired="False"/>
    <permission-map name="Field: Edit Profiles" acquired="False"/>
    <permission-map name="Field: Edit Publication Specification" acquired="False"/>
    <permission-map name="Field: Edit Rejection Reasons" acquired="False"/>
    <permission-map name="Field: Edit Results Interpretation" acquired="False"/>
    <permission-map name="Field: Edit Sample Point" acquired="False"/>
    <permission-map name="Field: Edit Sample Type" acquired="False"/>
    <permission-map name="Field: Edit Sample Condition" acquired="False"/>
    <permission-map name="Field: Edit Sampler" acquired="False"/>
    <permission-map name="Field: Edit Sampling Date" acquired="False"/>
    <permission-map name="Field: Edit Sampling Deviation" acquired="False"/>
    <permission-map name="Field: Edit Sampling Round" acquired="False"/>
    <permission-map name="Field: Edit Scheduled Sampler" acquired="False"/>
    <permission-map name="Field: Edit Storage Location" acquired="False"/>
    <permission-map name="Field: Edit Template" acquired="False"/>
    <permission-map name="Field: Edit Specification" acquired="False"/>
    <!-- /MANAGED PERMISSIONS -->
  </state>
  <!-- /State: cancelled -->


  <!-- *** TRANSITIONS *** -->


  <transition transition_id="attach" title="Attach" new_state="to_be_verified" trigger="USER" before_script="" after_script="" i18n:attributes="title">
    <action url="" category="workflow" icon="">Add attachment</action>
    <guard>
      <guard-expression>python:here.guard_attach_transition()</guard-expression>
    </guard>
  </transition>

  <!-- Transition: cancel
       Cancel transition can only be done when all analyses the request contains are
       in unassigned state (see the guard) -->
  <transition transition_id="cancel" title="Cancel" new_state="cancelled"
              trigger="USER" before_script="" after_script=""
              i18n:attributes="title">
    <action url="" category="workflow" icon="">Cancel</action>
    <guard>
      <guard-permission>BIKA: Cancel and reinstate</guard-permission>
      <guard-expression>python:here.guard_handler("cancel")</guard-expression>
    </guard>
  </transition>

  <transition transition_id="no_sampling_workflow" title="No sampling workflow"
              new_state="sample_due" trigger="USER" before_script=""
              after_script="" i18n:attributes="title">
    <action url="" category="workflow" icon="">No sampling workflow</action>
    <guard>
      <guard-permission>BIKA: Add Analysis Request</guard-permission>
      <guard-expression>python:here.guard_handler("no_sampling_workflow")</guard-expression>
    </guard>
  </transition>

  <transition transition_id="prepublish" title="Prepublish" new_state="" trigger="USER" before_script="" after_script="" i18n:attributes="title">
    <action url="" category="workflow" icon="">Prepublish</action>
    <guard>
      <guard-permission>BIKA: Publish</guard-permission>
      <guard-expression>python:here.guard_handler("prepublish")</guard-expression>
    </guard>
  </transition>

  <transition transition_id="preserve" title="Preserve" new_state="sample_due" trigger="USER" before_script="" after_script="" i18n:attributes="title">
    <action url="" category="workflow" icon="">Preserve</action>
    <guard>
      <guard-permission>BIKA: Preserve Sample</guard-permission>
      <guard-expression>python:here.guard_handler("preserve")</guard-expression>
    </guard>
  </transition>

  <transition transition_id="publish" title="Publish" new_state="published" trigger="USER" before_script="" after_script="" i18n:attributes="title">
    <action url="" category="workflow" icon="">Publish</action>
    <guard>
      <guard-permission>BIKA: Publish</guard-permission>
      <guard-expression>python:here.guard_handler("publish")</guard-expression>
    </guard>
  </transition>

  <transition transition_id="receive" title="Receive" new_state="sample_received"
              trigger="USER" before_script="" after_script="" i18n:attributes="title">
    <action url="" category="workflow" icon="">Receive sample</action>
    <guard>
      <guard-permission>BIKA: Receive Sample</guard-permission>
      <guard-expression>python:here.guard_handler("receive")</guard-expression>
    </guard>
  </transition>

  <!-- Transition: reinstate
       There is no new_state defined explicitly defined, cause the new_state will be
       the state before the request was cancelled. See after_reinstate -->
  <transition transition_id="reinstate" title="Reinstate"
              new_state="sample_registered"
              trigger="USER" before_script="" after_script=""
              i18n:attributes="title">
    <action url="" category="workflow" icon="">Reinstate</action>
    <guard>
      <guard-permission>BIKA: Cancel and reinstate</guard-permission>
      <guard-expression>python:here.guard_handler("reinstate")</guard-expression>
    </guard>
  </transition>

  <!-- Transition: create_partitions -->
  <transition transition_id="create_partitions" title="Create partitions"
              new_state="sample_received" trigger="USER"
              before_script="" after_script=""
              i18n:attributes="title">
    <action url="" category="workflow" icon="">Create partitions</action>
    <guard>
      <guard-permission>BIKA: Edit Results</guard-permission>
      <guard-expression>python:here.guard_handler("create_partitions")</guard-expression>
    </guard>
  </transition>
  <!-- /Transition: create_partitions -->

  <transition transition_id="republish" title="Republish" new_state="" trigger="USER" before_script="" after_script="" i18n:attributes="title">
    <action url="" category="workflow" icon="">Republish</action>
    <guard>
      <guard-permission>BIKA: Publish</guard-permission>
      <guard-expression>python:here.guard_handler("republish")</guard-expression>
    </guard>
  </transition>

  <transition transition_id="retract" title="Retract" new_state="sample_received" trigger="USER" before_script="" after_script="" i18n:attributes="title">
    <action url="" category="workflow" icon="">Retract</action>
    <guard>
      <guard-expression>python:here.guard_handler('retract')</guard-expression>
    </guard>
  </transition>

  <!-- Transition: rollback_to_receive
       This transition is used for rolling back the Analysis Request to sample_due
       state when transitions performed to its analyses might cause state an
       inconsistent state. E.g. if the AR is in "to_be_verified" state and a single
       analysis is retracted, then the AR must be transitioned to "sample_received".
       This prevents the "bad" use of changeWorkflowState func in favor of a
       consistent transition.
       No need of guard-permission here, because:
       1) This transition is governed by the permissions set in analysis workflow.
       2) The guard always returns False unless there is an inconsistency
  -->
  <transition transition_id="rollback_to_receive" title="Rollback"
              new_state="sample_received" trigger="USER" before_script=""
              after_script="" i18n:attributes="title">
    <action url="" category="workflow" icon="">Rollback</action>
    <guard>
      <guard-expression>python:here.guard_handler("rollback_to_receive")</guard-expression>
    </guard>
  </transition>

  <transition transition_id="invalidate" title="Invalidate" new_state="invalid" trigger="USER" before_script="" after_script="" i18n:attributes="title">
    <action url="" category="workflow" icon="">Invalidate</action>
    <guard>
      <guard-permission>BIKA: Retract</guard-permission>
      <guard-expression>python:here.guard_handler("invalidate")</guard-expression>
    </guard>
  </transition>

  <!-- Transition: sample
       The sample has been collected and is due for reception. This transition
       requires the Sampler and DateSampled fields to be set -->
  <transition transition_id="sample" title="Sample" new_state="sample_due"
              trigger="USER" before_script="" after_script=""
              i18n:attributes="title">
    <action url="" category="workflow" icon="">Sample</action>
    <guard>
      <guard-permission>BIKA: Sample Sample</guard-permission>
      <guard-expression>python:here.guard_handler("sample")</guard-expression>
    </guard>
  </transition>

  <transition transition_id="sample_due" title="Sample due" new_state="sample_due" trigger="USER" before_script="" after_script="" i18n:attributes="title">
    <action url="" category="workflow" icon="">Sample due</action>
    <guard>
    </guard>
  </transition>

  <!-- Transition: To be sampled
       This transition takes place automatically when sample collection is enabled
       for the current Analysis Request, either because the setting is enabled by
       default in setup or because a template with this setting enabled has been
       used to create the Analysis Request.
       There is no need of guard-permission, cause this transition is triggered
       automatically when the Analysis Request is created for the first time.
  -->
  <transition transition_id="to_be_sampled" title="To be sampled"
              new_state="to_be_sampled" trigger="USER" before_script=""
              after_script="" i18n:attributes="title">
    <action url="" category="workflow" icon="">To be sampled</action>
    <guard>
      <guard-expression>python:here.guard_handler("to_be_sampled")</guard-expression>
    </guard>
  </transition>

  <transition transition_id="schedule_sampling" title="Schedule sampling" new_state="scheduled_sampling" trigger="USER" before_script="" after_script="" i18n:attributes="title">
    <action url="" category="workflow" icon="">Schedule sampling</action>
    <guard>
      <guard-permission>BIKA: Schedule Sampling</guard-permission>
      <guard-expression>python:here.guard_handler("schedule_sampling")</guard-expression>
    </guard>
  </transition>

  <transition transition_id="submit" title="Submit" new_state="to_be_verified" trigger="USER" before_script="" after_script="" i18n:attributes="title">
    <action url="" category="workflow" icon="">Submit for verification</action>
    <guard>
      <guard-expression>python:here.guard_handler("submit")</guard-expression>
    </guard>
  </transition>

  <transition transition_id="to_be_preserved" title="To be preserved" new_state="to_be_preserved" trigger="USER" before_script="" after_script="" i18n:attributes="title">
    <action url="" category="workflow" icon="">To be preserved</action>
    <guard>
    </guard>
  </transition>

  <transition transition_id="verify" title="Verify" new_state="verified" trigger="USER" before_script="" after_script="" i18n:attributes="title">
    <action url="" category="workflow" icon="">Verify</action>
    <guard>
      <guard-expression>python:here.guard_handler("verify")</guard-expression>
    </guard>
  </transition>

  <transition transition_id="reject" title="Reject" new_state="rejected" trigger="USER" before_script="" after_script="" i18n:attributes="title">
    <action url="" category="workflow" icon="">Reject</action>
    <guard>
      <guard-expression>python:here.bika_setup.isRejectionWorkflowEnabled()</guard-expression>
      <guard-permission>Reject Analysis Request</guard-permission>
    </guard>
  </transition>


  <!-- *** VARIABLES *** -->


  <variable variable_id="action" for_catalog="False" for_status="True" update_always="True">
    <description>Previous transition</description>
    <default>
      <expression>transition/getId|nothing</expression>
    </default>
    <guard>
    </guard>
  </variable>

  <variable variable_id="actor" for_catalog="False" for_status="True" update_always="True">
    <description>The ID of the user who performed the last transition</description>
    <default>
      <expression>user/getId</expression>
    </default>
    <guard>
    </guard>
  </variable>

  <variable variable_id="comments" for_catalog="False" for_status="True" update_always="True">
    <description>Comment about the last transition</description>
    <default>
      <expression>python:state_change.kwargs.get('comment', '')</expression>
    </default>
    <guard>
    </guard>
  </variable>

  <variable variable_id="review_history" for_catalog="False" for_status="False" update_always="False">
    <description>Provides access to workflow history</description>
    <default>
      <expression>state_change/getHistory</expression>
    </default>
    <guard>
      <guard-permission>Request review</guard-permission>
      <guard-permission>Review portal content</guard-permission>
    </guard>
  </variable>

  <variable variable_id="time" for_catalog="False" for_status="True" update_always="True">
    <description>When the previous transition was performed</description>
    <default>
      <expression>state_change/getDateTime</expression>
    </default>
    <guard>
    </guard>
  </variable>

</dc-workflow>
